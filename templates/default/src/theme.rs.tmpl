use gpui::{Global, Hsla};

#[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]
pub enum ThemeMode {
    #[default]
    Light,
    Dark,
}

#[derive(Debug, Clone, Copy, PartialEq, Default)]
pub enum Radius {
    None,
    Sm,
    #[default]
    Md,
    Lg,
    Full,
}

impl Radius {
    pub fn to_px(&self) -> f32 {
        match self {
            Radius::None => 0.0,
            Radius::Sm => 4.0,
            Radius::Md => 6.0,
            Radius::Lg => 8.0,
            Radius::Full => 9999.0,
        }
    }
}

#[derive(Debug, Clone)]
pub struct Theme {
    pub name: String,
    pub mode: ThemeMode,
    pub colors: ThemeColors,
    pub radius: Radius,
}

impl Global for Theme {}

#[derive(Debug, Clone)]
pub struct ThemeColors {
    pub background: Hsla,
    pub foreground: Hsla,
    pub card: Hsla,
    pub card_foreground: Hsla,
    pub popover: Hsla,
    pub popover_foreground: Hsla,
    pub primary: Hsla,
    pub primary_foreground: Hsla,
    pub secondary: Hsla,
    pub secondary_foreground: Hsla,
    pub muted: Hsla,
    pub muted_foreground: Hsla,
    pub accent: Hsla,
    pub accent_foreground: Hsla,
    pub destructive: Hsla,
    pub destructive_foreground: Hsla,
    pub border: Hsla,
    pub input: Hsla,
    pub ring: Hsla,
}

fn hsl(h: f32, s: f32, l: f32) -> Hsla {
    Hsla {
        h: h / 360.0,
        s: s / 100.0,
        l: l / 100.0,
        a: 1.0,
    }
}

pub fn {{base_color}}(mode: ThemeMode) -> Theme {
    // TODO: Colors will be filled by `shadcn-ui init`
    let colors = match mode {
        ThemeMode::Light => ThemeColors {
            background: hsl(0.0, 0.0, 100.0),
            foreground: hsl(240.0, 10.0, 3.9),
            card: hsl(0.0, 0.0, 100.0),
            card_foreground: hsl(240.0, 10.0, 3.9),
            popover: hsl(0.0, 0.0, 100.0),
            popover_foreground: hsl(240.0, 10.0, 3.9),
            primary: hsl(240.0, 5.9, 10.0),
            primary_foreground: hsl(0.0, 0.0, 98.0),
            secondary: hsl(240.0, 4.8, 95.9),
            secondary_foreground: hsl(240.0, 5.9, 10.0),
            muted: hsl(240.0, 4.8, 95.9),
            muted_foreground: hsl(240.0, 3.8, 46.1),
            accent: hsl(240.0, 4.8, 95.9),
            accent_foreground: hsl(240.0, 5.9, 10.0),
            destructive: hsl(0.0, 84.2, 60.2),
            destructive_foreground: hsl(0.0, 0.0, 98.0),
            border: hsl(240.0, 5.9, 90.0),
            input: hsl(240.0, 5.9, 90.0),
            ring: hsl(240.0, 5.9, 10.0),
        },
        ThemeMode::Dark => ThemeColors {
            background: hsl(240.0, 10.0, 3.9),
            foreground: hsl(0.0, 0.0, 98.0),
            card: hsl(240.0, 10.0, 3.9),
            card_foreground: hsl(0.0, 0.0, 98.0),
            popover: hsl(240.0, 10.0, 3.9),
            popover_foreground: hsl(0.0, 0.0, 98.0),
            primary: hsl(0.0, 0.0, 98.0),
            primary_foreground: hsl(240.0, 5.9, 10.0),
            secondary: hsl(240.0, 3.7, 15.9),
            secondary_foreground: hsl(0.0, 0.0, 98.0),
            muted: hsl(240.0, 3.7, 15.9),
            muted_foreground: hsl(240.0, 5.0, 64.9),
            accent: hsl(240.0, 3.7, 15.9),
            accent_foreground: hsl(0.0, 0.0, 98.0),
            destructive: hsl(0.0, 62.8, 30.6),
            destructive_foreground: hsl(0.0, 0.0, 98.0),
            border: hsl(240.0, 3.7, 15.9),
            input: hsl(240.0, 3.7, 15.9),
            ring: hsl(240.0, 4.9, 83.9),
        },
    };

    Theme {
        name: "{{base_color}}".to_string(),
        mode,
        colors,
        radius: Radius::{{radius}},
    }
}
